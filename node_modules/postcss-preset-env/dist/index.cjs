"use strict";var e=require("autoprefixer"),s=require("cssdb"),t=require("@csstools/postcss-progressive-custom-properties"),o=require("fs"),i=require("path"),r=require("browserslist"),n=require("postcss-initial"),a=require("postcss-pseudo-class-any-link"),c=require("css-blank-pseudo"),p=require("postcss-page-break"),u=require("postcss-attribute-case-insensitive"),l=require("postcss-clamp"),m=require("@csstools/postcss-color-function"),d=require("postcss-color-functional-notation"),f=require("postcss-custom-media"),g=require("postcss-custom-properties"),b=require("postcss-custom-selectors"),h=require("postcss-dir-pseudo-class"),y=require("@csstools/postcss-normalize-display-values"),k=require("postcss-double-position-gradients"),N=require("postcss-env-function"),w=require("postcss-focus-visible"),v=require("postcss-focus-within"),$=require("@csstools/postcss-font-format-keywords"),q=require("postcss-font-variant"),O=require("postcss-gap-properties"),S=require("css-has-pseudo"),x=require("postcss-color-hex-alpha"),j=require("@csstools/postcss-hwb-function"),P=require("@csstools/postcss-ic-unit"),F=require("postcss-image-set-function"),E=require("@csstools/postcss-is-pseudo-class"),M=require("postcss-lab-function"),C=require("postcss-logical"),A=require("postcss-media-minmax"),R=require("postcss-nesting"),_=require("postcss-selector-not"),U=require("@csstools/postcss-oklab-function"),B=require("postcss-opacity-percentage"),I=require("postcss-overflow-shorthand"),T=require("postcss-replace-overflow-wrap"),W=require("postcss-place"),L=require("css-prefers-color-scheme"),V=require("postcss-color-rebeccapurple");function D(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var H=D(e),J=D(s),z=D(t),G=D(o),K=D(i),Q=D(r),X=D(n),Y=D(a),Z=D(c),ee=D(p),se=D(u),te=D(l),oe=D(m),ie=D(d),re=D(f),ne=D(g),ae=D(b),ce=D(h),pe=D(y),ue=D(k),le=D(N),me=D(w),de=D(v),fe=D($),ge=D(q),be=D(O),he=D(S),ye=D(x),ke=D(j),Ne=D(P),we=D(F),ve=D(E),$e=D(M),qe=D(C),Oe=D(A),Se=D(R),xe=D(_),je=D(U),Pe=D(B),Fe=D(I),Ee=D(T),Me=D(W),Ce=D(L),Ae=D(V);const Re={"blank-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-blank-pseudo/README-BROWSER.md","focus-visible-pseudo-class":"https://github.com/WICG/focus-visible","focus-within-pseudo-class":"https://github.com/jsxtools/focus-within/blob/master/README-BROWSER.md","has-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-has-pseudo/README-BROWSER.md","prefers-color-scheme-query":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-prefers-color-scheme/README-BROWSER.md"},_e=["blank-pseudo-class","focus-visible-pseudo-class","focus-within-pseudo-class","has-pseudo-class","prefers-color-scheme-query"];async function Ue(e,s,t,o){const i=function(e){return`:root {\n${Object.keys(e).reduce(((s,t)=>(s.push(`\t${t}: ${e[t]};`),s)),[]).join("\n")}\n}\n`}(t),r=function(e){return`${Object.keys(e).reduce(((s,t)=>(s.push(`@custom-media ${t} ${e[t]};`),s)),[]).join("\n")}\n`}(s),n=function(e){return`${Object.keys(e).reduce(((s,t)=>(s.push(`@custom-selector ${t} ${e[t]};`),s)),[]).join("\n")}\n`}(o),a=`${r}\n${n}\n${i}`;await Le(e,a)}function Be(e,s){return`\n\t${e}: {\n${Object.keys(s).reduce(((e,t)=>(e.push(`\t\t'${Ve(t)}': '${Ve(s[t])}'`),e)),[]).join(",\n")}\n\t}`}function Ie(e,s){return`export const ${e} = {\n${Object.keys(s).reduce(((e,t)=>(e.push(`\t'${Ve(t)}': '${Ve(s[t])}'`),e)),[]).join(",\n")}\n};\n`}function Te(e,s){return Promise.all([].concat(s).map((async s=>{if(s instanceof Function)await s({customMedia:We(e.customMedia),customProperties:We(e.customProperties),customSelectors:We(e.customSelectors)});else{const t=s===Object(s)?s:{to:String(s)},o=t.toJSON||We;if("customMedia"in t||"customProperties"in t||"customSelectors"in t)t.customMedia=o(e.customMedia),t.customProperties=o(e.customProperties),t.customSelectors=o(e.customSelectors);else if("custom-media"in t||"custom-properties"in t||"custom-selectors"in t)t["custom-media"]=o(e.customMedia),t["custom-properties"]=o(e.customProperties),t["custom-selectors"]=o(e.customSelectors);else{const s=String(t.to||""),i=(t.type||K.default.extname(t.to).slice(1)).toLowerCase(),r=o(e.customMedia),n=o(e.customProperties),a=o(e.customSelectors);"css"===i&&await Ue(s,r,n,a),"js"===i&&await async function(e,s,t,o){const i=`module.exports = {${Be("customMedia",s)},${Be("customProperties",t)},${Be("customSelectors",o)}\n};\n`;await Le(e,i)}(s,r,n,a),"json"===i&&await async function(e,s,t,o){const i=`${JSON.stringify({"custom-media":s,"custom-properties":t,"custom-selectors":o},null,"  ")}\n`;await Le(e,i)}(s,r,n,a),"mjs"===i&&await async function(e,s,t,o){const i=`${Ie("customMedia",s)}\n${Ie("customProperties",t)}\n${Ie("customSelectors",o)}`;await Le(e,i)}(s,r,n,a)}}})))}function We(e){return Object.keys(e).reduce(((s,t)=>(s[t]=String(e[t]),s)),{})}function Le(e,s){return new Promise(((t,o)=>{G.default.writeFile(e,s,(e=>{e?o(e):t()}))}))}function Ve(e){return e.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function De(e,s){if(!e)return!1;if("string"==typeof e)return!0;if(Array.isArray(e)){for(let t=0;t<e.length;t++){if("string"==typeof e[t])return!0;if(e[t]&&s in Object(e[t]))return!0}return!1}return s in Object(e)}function He(e,s,t){return Math.max(e,Math.min(s,t))}const Je=Symbol("insertBefore"),ze=Symbol("insertAfter"),Ge=Symbol("insertOrder"),Ke=Symbol("plugin");function Qe(e,s,t){if("insertBefore"!==t&&"insertAfter"!==t)return[];const o="insertBefore"===t?Je:ze,i=[];for(const t in s){if(!Object.hasOwnProperty.call(s,t))continue;if(!e.find((e=>e.id===t)))continue;let r=s[t];Array.isArray(r)||(r=[r]);for(let e=0;e<r.length;e++)i.push({id:t,[Ke]:r[e],[Ge]:e,[o]:!0})}return i}var Xe=["custom-media-queries","custom-properties","environment-variables","image-set-function","media-query-ranges","prefers-color-scheme-query","nesting-rules","custom-selectors","any-link-pseudo-class","case-insensitive-attributes","focus-visible-pseudo-class","focus-within-pseudo-class","not-pseudo-class","logical-properties-and-values","dir-pseudo-class","all-property","color-functional-notation","double-position-gradients","hexadecimal-alpha-notation","hwb-function","lab-function","rebeccapurple-color","blank-pseudo-class","break-properties","font-variant-property","is-pseudo-class","has-pseudo-class","gap-properties","overflow-property","overflow-wrap-property","place-properties","system-ui-font-family"];function Ye(){return{postcssPlugin:"postcss-system-ui-font",Declaration(e){Ze.test(e.prop)&&(e.value.includes(ss.join(", "))||(e.value=e.value.replace(ts,os)))}}}Ye.postcss=!0;const Ze=/(?:^(?:-|\\002d){2})|(?:^font(?:-family)?$)/i,es="[\\f\\n\\r\\x09\\x20]",ss=["system-ui","-apple-system","Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans","sans-serif"],ts=new RegExp(`(^|,|${es}+)(?:system-ui${es}*)(?:,${es}*(?:${ss.join("|")})${es}*)?(,|$)`,"i"),os=`$1${ss.join(", ")}$2`,is=new Map([["all-property",X.default],["any-link-pseudo-class",Y.default],["blank-pseudo-class",Z.default],["break-properties",ee.default],["case-insensitive-attributes",se.default],["clamp",te.default],["color-function",oe.default],["color-functional-notation",ie.default],["custom-media-queries",re.default],["custom-properties",ne.default],["custom-selectors",ae.default],["dir-pseudo-class",ce.default],["display-two-values",pe.default],["double-position-gradients",ue.default],["environment-variables",le.default],["focus-visible-pseudo-class",me.default],["focus-within-pseudo-class",de.default],["font-format-keywords",fe.default],["font-variant-property",ge.default],["gap-properties",be.default],["has-pseudo-class",he.default],["hexadecimal-alpha-notation",ye.default],["hwb-function",ke.default],["ic-unit",Ne.default],["image-set-function",we.default],["is-pseudo-class",ve.default],["lab-function",$e.default],["logical-properties-and-values",qe.default],["media-query-ranges",Oe.default],["nesting-rules",Se.default],["not-pseudo-class",xe.default],["oklab-function",je.default],["opacity-percentage",Pe.default],["overflow-property",Fe.default],["overflow-wrap-property",Ee.default],["place-properties",Me.default],["prefers-color-scheme-query",Ce.default],["rebeccapurple-color",Ae.default],["system-ui-font-family",Ye]]);function rs(e,s,t){return e.concat(Qe(e,s,"insertBefore"),Qe(e,t,"insertAfter")).filter((e=>function(e){return!!e[Je]||!!e[ze]||!!is.has(e.id)}(e))).sort(((e,s)=>function(e,s){return e.id===s.id?e[Je]&&s[Je]||e[ze]&&s[ze]?He(-1,e[Ge]-s[Ge],1):e[Je]||s[ze]?-1:e[ze]||s[Je]?1:0:He(-1,Xe.indexOf(e.id)-Xe.indexOf(s.id),1)}(e,s)))}const ns=["ie","edge","firefox","chrome","safari","opera","ios_saf","android","op_mob","and_chr","and_ff","and_uc","samsung","and_qq","baidu","kaios"];function as(e){if(!e)return[];if(!("browser_support"in e))return["> 0%"];const s=[];return ns.forEach((t=>{const o=e.browser_support[t];"string"==typeof o&&/^[0-9|.]+$/.test(o)?s.push(`${t} < ${e.browser_support[t]}`):s.push(`${t} >= 1`)})),s}function cs(e,s,t,o){const i=Q.default(e,{ignoreUnknownVersions:!0});switch(s.id){case"is-pseudo-class":return{onComplexSelector:"warning"};case"nesting-rules":if(function(e,s){const t=as(e);if(s.some((e=>Q.default(t,{ignoreUnknownVersions:!0}).some((s=>s===e)))))return!0;return!1}(t.find((e=>"is-pseudo-class"===e.id)),i))return o.log('Disabling :is on "nesting-rules" due to lack of browser support.'),{noIsPseudoSelector:!0};return{};case"any-link-pseudo-class":if(i.find((e=>e.startsWith("ie ")||e.startsWith("edge "))))return o.log('Adding area[href] fallbacks for ":any-link" support in Edge and IE.'),{subFeatures:{areaHrefNeedsFixing:!0}};return{};default:return{}}}function ps(e,s,t,o){const i=Object(s.features),r=!("enableClientSidePolyfills"in s)||s.enableClientSidePolyfills,n=Object(s.insertBefore),a=Object(s.insertAfter),c=s.browsers,p=He(0,function(e){const s=parseInt(e,10);return Number.isNaN(s)?0:s}(s.minimumVendorImplementations),3);p>0&&o.log(`Using features with ${p} or more vendor implementations`);const u=function(e,s){let t=2;if(void 0===e.stage)return s.log(`Using features from Stage ${t} (default)`),t;if(!1===e.stage)t=5;else{let s=parseInt(e.stage,10);Number.isNaN(s)&&(s=0),t=He(0,s,5)}return 5===t?s.log('Stage has been disabled, features will be handled via the "features" option.'):s.log(`Using features from Stage ${t}`),t}(s,o);2===u&&t&&!1===t.preserve&&(e=JSON.parse(JSON.stringify(e))).forEach((e=>{("blank-pseudo-class"===e.id||"prefers-color-scheme-query"===e.id)&&(e.stage=1)}));const l=rs(e,n,a).map((e=>function(e){const s=as(e);if(e[Je]||e[ze]){let t=e.id;return t=e.insertBefore?`before-${t}`:`after-${t}`,{browsers:s,vendors_implementations:e.vendors_implementations,plugin:e[Ke],id:t,stage:6}}return{browsers:s,vendors_implementations:e.vendors_implementations,plugin:is.get(e.id),id:e.id,stage:e.stage}}(e))).filter((e=>0===p||(!(!e[Je]&&!e[ze])||(p<=e.vendors_implementations||(i[e.id]?(o.log(`  ${e.id} does not meet the required vendor implementations but has been enabled by options`),!0):(o.log(`  ${e.id} with ${e.vendors_implementations} vendor implementations has been disabled`),!1)))))).filter((e=>{const s=e.stage>=u,t=r||!_e.includes(e.id),n=!1===i[e.id],a=i[e.id]?i[e.id]:s&&t;return n?o.log(`  ${e.id} has been disabled by options`):s?t||o.log(`  ${e.id} has been disabled by "enableClientSidePolyfills: false".`):a?o.log(`  ${e.id} does not meet the required stage but has been enabled by options`):o.log(`  ${e.id} with stage ${e.stage} has been disabled`),a})).map((s=>function(e,s,t,o,i,r){let n,a;return n=cs(s,o,e,r),!0===t[o.id]?i&&(n=Object.assign({},n,i)):n=i?Object.assign({},n,i,t[o.id]):Object.assign({},n,t[o.id]),n.enableProgressiveCustomProperties=!1,a=o.plugin.postcss&&"function"==typeof o.plugin?o.plugin(n):o.plugin&&o.plugin.default&&"function"==typeof o.plugin.default&&o.plugin.default.postcss?o.plugin.default(n):o.plugin,{browsers:o.browsers,vendors_implementations:o.vendors_implementations,plugin:a,pluginOptions:n,id:o.id}}(e,c,i,s,t,o))),m=Q.default(c,{ignoreUnknownVersions:!0});return l.filter((e=>{if(e.id in i)return i[e.id];if(function(e){if("importFrom"in Object(e.pluginOptions))switch(e.id){case"custom-media-queries":if(De(e.pluginOptions.importFrom,"customMedia"))return!0;break;case"custom-properties":if(De(e.pluginOptions.importFrom,"customProperties"))return!0;break;case"environment-variables":if(De(e.pluginOptions.importFrom,"environmentVariables"))return!0;break;case"custom-selectors":if(De(e.pluginOptions.importFrom,"customSelectors"))return!0}if("exportTo"in Object(e.pluginOptions))switch(e.id){case"custom-media-queries":if(De(e.pluginOptions.exportTo,"customMedia"))return!0;break;case"custom-properties":if(De(e.pluginOptions.exportTo,"customProperties"))return!0;break;case"environment-variables":if(De(e.pluginOptions.exportTo,"environmentVariables"))return!0;break;case"custom-selectors":if(De(e.pluginOptions.exportTo,"customSelectors"))return!0}return!1}(e))return!0;const s=Q.default(e.browsers,{ignoreUnknownVersions:!0}),t=m.some((e=>s.some((s=>s===e))));return t||o.log(`${e.id} disabled due to browser support`),t}))}class us{constructor(){this.logs=[]}log(e){this.logs.push(e)}resetLogger(){this.logs.length=0}dumpLogs(e){e&&this.logs.forEach((s=>e.warn(s))),this.resetLogger()}}var ls=[{packageName:"css-blank-pseudo",id:"blank-pseudo-class",importName:"postcssBlankPseudo"},{packageName:"css-has-pseudo",id:"has-pseudo-class",importName:"postcssHasPseudo"},{packageName:"css-prefers-color-scheme",id:"prefers-color-scheme-query",importName:"postcssPrefersColorScheme"},{packageName:"postcss-attribute-case-insensitive",id:"case-insensitive-attributes",importName:"postcssAttributeCaseInsensitive"},{packageName:"postcss-clamp",id:"clamp",importName:"postcssClamp"},{packageName:"@csstools/postcss-color-function",id:"color-function",importName:"postcssColorFunction"},{packageName:"postcss-color-functional-notation",id:"color-functional-notation",importName:"postcssColorFunctionalNotation"},{packageName:"postcss-color-hex-alpha",id:"hexadecimal-alpha-notation",importName:"postcssColorHexAlpha"},{packageName:"postcss-color-rebeccapurple",id:"rebeccapurple-color",importName:"postcssColorRebeccapurple"},{packageName:"postcss-custom-media",id:"custom-media-queries",importName:"postcssCustomMedia"},{packageName:"postcss-custom-properties",id:"custom-properties",importName:"postcssCustomProperties"},{packageName:"postcss-custom-selectors",id:"custom-selectors",importName:"postcssCustomSelectors"},{packageName:"postcss-dir-pseudo-class",id:"dir-pseudo-class",importName:"postcssDirPseudoClass"},{packageName:"postcss-double-position-gradients",id:"double-position-gradients",importName:"postcssDoublePositionGradients"},{packageName:"postcss-env-function",id:"environment-variables",importName:"postcssEnvFunction"},{packageName:"postcss-focus-visible",id:"focus-visible-pseudo-class",importName:"postcssFocusVisible"},{packageName:"postcss-focus-within",id:"focus-within-pseudo-class",importName:"postcssFocusWithin"},{packageName:"@csstools/postcss-font-format-keywords",id:"font-format-keywords",importName:"postcssFontFormatKeywords"},{packageName:"postcss-font-variant",id:"font-variant-property",importName:"postcssFontVariant"},{packageName:"postcss-gap-properties",id:"gap-properties",importName:"postcssGapProperties"},{packageName:"@csstools/postcss-hwb-function",id:"hwb-function",importName:"postcssHWBFunction"},{packageName:"@csstools/postcss-ic-unit",id:"ic-unit",importName:"postcssICUnit"},{packageName:"postcss-image-set-function",id:"image-set-function",importName:"postcssImageSetFunction"},{packageName:"postcss-initial",id:"all-property",importName:"postcssInitial"},{packageName:"@csstools/postcss-is-pseudo-class",id:"is-pseudo-class",importName:"postcssIsPseudoClass"},{packageName:"postcss-lab-function",id:"lab-function",importName:"postcssLabFunction"},{packageName:"postcss-logical",id:"logical-properties-and-values",importName:"postcssLogical"},{packageName:"postcss-media-minmax",id:"media-query-ranges",importName:"postcssMediaMinmax"},{packageName:"postcss-nesting",id:"nesting-rules",importName:"postcssNesting"},{packageName:"@csstools/postcss-normalize-display-values",id:"display-two-values",importName:"postcssNormalizeDisplayValues"},{packageName:"@csstools/postcss-oklab-function",id:"oklab-function",importName:"postcssOKLabFunction"},{packageName:"postcss-opacity-percentage",id:"opacity-percentage",importName:"postcssOpacityPercentage"},{packageName:"postcss-overflow-shorthand",id:"overflow-property",importName:"postcssOverflowShorthand"},{packageName:"postcss-page-break",id:"break-properties",importName:"postcssPageBreak"},{packageName:"postcss-place",id:"place-properties",importName:"postcssPlace"},{packageName:"postcss-pseudo-class-any-link",id:"any-link-pseudo-class",importName:"postcssPseudoClassAnyLink"},{packageName:"postcss-replace-overflow-wrap",id:"overflow-wrap-property",importName:"postcssReplaceOverflowWrap"},{packageName:"postcss-selector-not",id:"not-pseudo-class",importName:"postcssSelectorNot"},{packageName:"postcss-system-ui-font-family",importedPackage:"../patch/postcss-system-ui-font-family.mjs",id:"system-ui-font-family",importName:"postcssFontFamilySystemUI"}];function ms(e,s,t){const o=ls.map((e=>e.id)),i=ls.map((e=>e.packageName)),r=function(){const e={};return ls.forEach((s=>{e[s.packageName]=s.id})),e}();e.forEach((e=>{if(o.includes(e))return;const n=ds(e,o),a=ds(e,i);Math.min(n.distance,a.distance)>10?s.warn(t`Unknown feature: "${e}", see the list of features https://github.com/csstools/postcss-plugins/blob/main/plugin-packs/postcss-preset-env/FEATURES.md`):n.distance<a.distance?s.warn(t,`Unknown feature: "${e}", did you mean: "${n.mostSimilar}"`):s.warn(t,`Unknown feature: "${e}", did you mean: "${r[a.mostSimilar]}"`)}))}function ds(e,s){let t="unknown",o=1/0;for(let i=0;i<s.length;i++){const r=fs(e,s[i]);r<o&&(o=r,t=s[i])}return{mostSimilar:t,distance:o}}function fs(e,s){if(!e.length)return s.length;if(!s.length)return e.length;const t=[];for(let o=0;o<=s.length;o++){t[o]=[o];for(let i=1;i<=e.length;i++)t[o][i]=0===o?i:Math.min(t[o-1][i]+1,t[o][i-1]+1,t[o-1][i-1]+(e[i-1]===s[o-1]?0:1))}return t[s.length][e.length]}const gs=e=>{const s=new us,t=Object(e),o=Object.keys(Object(t.features)),i=t.browsers,r=function(e){if("importFrom"in e||"exportTo"in e||"preserve"in e){const s={};return"importFrom"in e&&(s.importFrom=e.importFrom),"exportTo"in e&&(s.exportTo={customMedia:{},customProperties:{},customSelectors:{}}),"preserve"in e&&(s.preserve=e.preserve),s}return!1}(t),n=ps(J.default,t,r,s),a=n.map((e=>e.plugin));!1!==t.autoprefixer&&a.push(H.default(Object.assign({overrideBrowserslist:i},t.autoprefixer))),a.push(z.default()),function(e,s,t){if(s.debug){t.log("Enabling the following feature(s):");const s=[];e.forEach((e=>{e.id.startsWith("before")||e.id.startsWith("after")?t.log(`  ${e.id} (injected via options)`):t.log(`  ${e.id}`),void 0!==Re[e.id]&&s.push(e.id)})),s.length&&(t.log("These feature(s) need a browser library to work:"),s.forEach((e=>t.log(` ${e}: ${Re[e]}`))))}}(n,t,s);const c=()=>({postcssPlugin:"postcss-preset-env",OnceExit:function(i,{result:n}){ms(o,i,n),t.debug&&s.dumpLogs(n),s.resetLogger(),t.exportTo&&Te(r.exportTo,e.exportTo)}});return c.postcss=!0,{postcssPlugin:"postcss-preset-env",plugins:[...a,c()]}};gs.postcss=!0,module.exports=gs;
